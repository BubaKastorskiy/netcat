(ns netcat.streamtransferer
   (:import (java.io BufferedReader IOException InputStream InputStreamReader OutputStream PrintWriter)))

(defn stream-receiver
   "Reads in the data."
   [input output]
   (let [reader (new BufferedReader (new InputStreamReader input))
         writer output]
      (try (loop [line (.readLine reader)]
              (when (not (nil? line))
                 (do (.println writer line)
                     (.flush writer)
                     (recur (.readLine reader)))))
           (finally (.close reader) (.close writer)))))

(defn stream-transmiter
   "Sends out the data."
   [input output]
   (let [reader (new BufferedReader (new InputStreamReader input))
         writer (new PrintWriter output)]
      (try (loop [line (.readLine reader)]
              (when (not (== line nil))
                 (do (.println writer line)
                     (.flush writer)
                     (recur (.readLine reader)))))
           (finally (.close reader) (.close writer)))))

